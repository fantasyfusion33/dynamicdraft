<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fantasy Draft Board</title>
  <style>
    /* Modern Professional Design */
    :root {
      --primary: #D2042D;
      --dark: #0A0A0A;
      --light: #FFFFFF;
      --gray: #1A1A1A;
      --glass: rgba(26, 26, 26, 0.8);
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--dark);
      color: var(--light);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .countdown-clock {
      position: fixed;
      top: 40px;
      left: calc(350px + 45px); /* Sidebar (350px) + 35px */
      width: 75px;
      font-size: 2rem;
      font-weight: 600;
      background: var(--glass);
      padding: 12px 20px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 300;
    }

    /* When the sidebar is collapsed, move the clock 35px from the left */
    .sidebar.collapsed ~ .countdown-clock {
     left: 45px;
    }

    .draft-header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 2rem 0;
      background: linear-gradient(135deg, var(--dark) 0%, #1a1a1a 100%);
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }

    .draft-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, rgba(210, 4, 45, 0.1) 0%, rgba(210, 4, 45, 0.05) 100%);
    }

    .current-player {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--light);
      padding: 12px 24px;
      background: var(--primary);
      border-radius: 8px;
      display: inline-block;
      backdrop-filter: blur(10px);
      margin: 1rem 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .current-player span {
      font-weight: 400;
      color: rgba(255, 255, 255, 0.8);
    }

    .current-player strong {
      font-weight: 700;
    }

   /* Filters and Search Bar */
.filters {
  display: flex;
  align-items: center;
  gap: 20px; /* Ensures even spacing */
  margin-bottom: 20px;
  padding-left: 10px; /* Adds space from the left edge */
}

.search-bar {
  position: relative;
  flex: 1;
  max-width: 200px;
  min-width: 200px;
  margin-left: 10px; /* Adds space between the search bar and left-most filter */
}

#teamSearch {
  width: 80%;
  padding: 8px 30px 8px 12px;
  background: var(--gray);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  color: var(--light);
  font-size: 14px;
}

.clear-search {
  position: absolute;
  right: 9px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  padding: 0;
  font-size: 1.2rem;
}

.clear-search:hover {
  color: var(--primary);
}

.filters select {
  padding: 10px 16px;
  background: var(--gray);
  color: var(--light);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.2s ease;
}

/* Ensures search bar and filters don't overlap */
.filters select:first-child {
  margin-right: 15px; /* Adds space between left-most filter and search bar */
}

.filters select:hover {
  border-color: var(--primary);
}

    .team-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 2rem;
    }

    .team-card {
      background: var(--glass);
      padding: 20px;
      border-radius: 12px;
      position: relative;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      z-index: 200;
    }

.team-card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}
    .team-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .team-card.NFL { border-left: 4px solid #8A2BE2; }
    .team-card.NBA { border-left: 4px solid #FF69B4; }
    .team-card.MLB { border-left: 4px solid #4169E1; }
    .team-card.NHL { border-left: 4px solid #FFA500; }
    .team-card.NCAAF { border-left: 4px solid #32CD32; }
    .team-card.NCAAB { border-left: 4px solid #FFD700; }

    .team-card h3 {
      margin: 0 0 8px;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--light);
    }

    .team-card p {
      margin: 4px 0;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .team-card button {
      margin-top: 16px;
      width: 100%;
      padding: 10px;
      background: var(--primary);
      color: var(--light);
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .team-card button:disabled {
      background: rgba(210, 4, 45, 0.3);
      cursor: not-allowed;
      opacity: 0.7;
    }

    .team-card button:hover:not(:disabled) {
      background: #B00326;
      transform: translateY(-1px);
    }

    .flag {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 6px;
      right: 6px;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 500;
      z-index: 1;
      line-height: 1.2;
      text-align: center;
    }

    .flag.in-season { background: rgba(0, 255, 0, 0.15); color: #00FF00; }
    .flag.off-season { background: rgba(255, 0, 0, 0.15); color: #FF4444; }

    .rosters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-top: 2rem;
    }

    .roster {
      background: var(--glass);
      padding: 20px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 100;
    }

    .roster h2 {
      margin: 0 0 16px;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--light);
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-transform: uppercase;
      letter-spacing: 1px;
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      border-radius: 6px;
      z-index: 100;

    }

    .roster ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .roster li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.03);
    }
    /* Add these styles to your CSS */
    .roster li strong {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--light);
      background: rgba(255, 255, 255, 0.1);
      padding: 8px;
      border-radius: 6px;
      display: block;
      margin: 8px 0;
    }

    .roster li:last-child {
      border-bottom: none;
    }

    .roster li.NFL { border-left: 4px solid #8A2BE2; }
    .roster li.NBA { border-left: 4px solid #FF69B4; }
    .roster li.MLB { border-left: 4px solid #4169E1; }
    .roster li.NHL { border-left: 4px solid #FFA500; }
    .roster li.NCAAF { border-left: 4px solid #32CD32; }
    .roster li.NCAAB { border-left: 4px solid #FFD700; }

    .draft-pick-circle {
      background: var(--primary);
      color: var(--light);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .draft-pick-circle.NFL { background: #8A2BE2; }
    .draft-pick-circle.NBA { background: #FF69B4; }
    .draft-pick-circle.MLB { background: #4169E1; }
    .draft-pick-circle.NHL { background: #FFA500; }
    .draft-pick-circle.NCAAF { background: #32CD32; }
    .draft-pick-circle.NCAAB { background: #FFD700; }

    .draft-status-bar {
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      margin: 20px 0;
      position: relative;
    }

    .draft-progress {
      height: 100%;
      background: var(--primary);
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    @keyframes pulse-glow {
      0% { box-shadow: 0 0 0 0 rgba(210, 4, 45, 0.4); }
      100% { box-shadow: 0 0 0 6px rgba(210, 4, 45, 0); }
    }

    .urgent {
      animation: pulse-glow 1.5s infinite;
    }

.draft-complete {
  margin: 0 !important; /* Remove default margins */
  padding: 20px !important; /* Add padding for spacing */
  width: 100% !important; /* Ensure full width */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--dark); /* Match the background color */
}

.draft-complete-container {
  padding: 20px;
  overflow-y: auto;
  height: calc(100vh - 120px);
  scrollbar-width: none; /* Firefox */
}

.draft-complete-container::-webkit-scrollbar {
  display: none; /* Chrome, Safari */
}

.final-rosters {
  display: flex;
  justify-content: center;
  gap: 25px;
  width: 100%;
}

.final-rosters .roster {
  display: block; /* Change from flex to block */
  width: 350px;
  background: var(--glass);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.final-rosters .roster h2 {
  text-align: center; /* Center the title */
  margin-bottom: 20px; /* Add space below the title */
}

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 350px;
      height: 100vh;
      background: var(--glass);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 4px 0 12px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
      z-index: 100;
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar-toggle {
      position: fixed;
      top: 20px;
      left: 350px;
      background: var(--primary);
      color: var(--light);
      border: none;
      padding: 10px;
      border-radius: 0 6px 6px 0;
      cursor: pointer;
      transition: left 0.3s ease;
      z-index: 300;
    }

    .sidebar.collapsed + .sidebar-toggle {
      left: 0px;
      transform: translateX(-100); /* Ensure button stays visible */
    }

    .sidebar-toggle .arrow {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .sidebar.collapsed .sidebar-toggle .arrow {
      transform: rotate(180deg);
    }

    .team-selector {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .team-selector select {
      width: 100%;
      padding: 10px;
      background: var(--gray);
      color: var(--light);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .team-selector select:hover {
      border-color: var(--primary);
    }

   .roster-container {
     padding: 20px;
     overflow-y: auto;
     height: calc(100vh - 120px);
     scrollbar-width: none; /* Firefox */
   }

   .roster-container::-webkit-scrollbar {
     display: none; /* Chrome, Safari */
   }


    .roster {
      display: none;
    }

    .roster.active {
      display: block;
    }

    .main-content {
      margin-left: 350px;
      transition: margin-left 0.3s ease;
    }

    .sidebar.collapsed ~ .main-content {
      margin-left: 0;
    }
.team-icon {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primaryColor);
  position: relative;
  margin-right: 8px;
}

.team-icon i {
  font-size: 20px; /* Adjust icon size */
  color: var(--secondaryColor); /* Use secondary color for the icon */
}
/* MyTeam Box */
#myTeamBox {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 275px;
  height: 200px;
  background: #333; /* Dark gray background */
  padding: 16px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 300;
  transition: transform 0.3s ease;
}

#myTeamContent h3 {
  text-align: center; /* Center text horizontally */
  display: flex;
  align-items: center; /* Center text vertically */
  justify-content: center; /* Center horizontally */
  height: 50px; /* Adjust based on available space */
  margin: 0; /* Remove default margins */
}


#myTeamBox.collapsed {
  transform: translateX(calc(100% - 40px)); /* Collapse to the right */
}

#myTeamBox.collapsed #myTeamContent {
  display: none; /* Hide content when collapsed */
}

#toggleMyTeam {
  position: absolute;
  top: 10px;
  left: -38px;
  background: #D2042D; /* Primary color */
  color: #FFF;
  border: none;
  padding: 8px 12px; /* Wider padding for better click area */
  border-radius: 6px 0 0 6px; /* Rounded corners on the left */
  cursor: pointer;
  font-size: 16px; /* Adjust arrow size */
  display: flex;
  align-items: center;
  justify-content: center;
}

#toggleMyTeam .arrow {
  transition: transform 0.3s ease;
}

#myTeamBox.collapsed #toggleMyTeam .arrow {
  transform: rotate(0deg); /* Arrow pointing left (◀) */
}

#myTeamBox:not(.collapsed) #toggleMyTeam .arrow {
  transform: rotate(180deg); /* Arrow pointing right (▶) */
}

.sport-grid {
  display: grid;
  margin-top: -10px;
  grid-template-columns: repeat(2, 1fr);
  gap: 1px;
}

.sport-slot h4 {
  margin: 0 0 0px;
  font-size: 14px;
  color: #FFF;
  text-align: center;
}

.sport-slot:nth-child(2n) { /* Selects every second item (right column) */
  margin-top: 4px;
}

.slots {
  display: flex;
  gap: 8px;
  justify-content: center;
}

/* My Team Box Slots */
.slot {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1); /* Light gray for empty slots */
  display: block;
  align-items: center;
  justify-content: center;
  transition: background 0.3s ease;
  position: relative; /* For positioning */
}

/* Team Icons */
.team-icon {
  width: 32px; /* Ensure width matches slot size */
  height: 32px; /* Ensure height matches slot size */
  border-radius: 50%; /* Make it a perfect circle */
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primaryColor); /* Use team's primary color */
}

.team-icon i {
  font-size: 20px; /* Adjust icon size to fit inside the circle */
  color: var(--secondaryColor); /* Use team's secondary color */
}

/* Filled Slot Styling */
.slot.filled {
  background: transparent; /* Remove gray background when filled */
}


/* Responsive adjustments */
@media (max-width: 768px) {
  #myTeamBox {
    transform: translateX(calc(100% - 40px)); /* Collapse by default on small screens */
  }

  #myTeamBox.collapsed {
    transform: translateX(0); /* Expand when toggled */
  }
}

/* Team Popup Styles */
.team-popup {
  display: none;
  position: fixed;
  background: var(--glass);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 16px;
  backdrop-filter: blur(10px);
  z-index: 300;
  width: 150px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.team-popup-content {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.team-popup-body p {
  margin: 4px 0;
  font-size: 0.9rem;
}

.wildcard-badge {
  display: inline-block;
  background: #FFD700;
  color: #000;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.8rem;
  margin-left: 8px;
}

/* Mobile Styles (applied when screen width is less than 768px) */
@media (max-width: 768px) {
  /* Shrink clock */
  .countdown-clock {
    top: 10px;
    left: 10px;
    font-size: 1.2rem;
    padding: 6px 12px;
    width: 60px;
  }

  /* Smaller sidebar */
  .sidebar {
    width: 200px; /* Narrower sidebar */
    transform: translateX(-100%); /* Start hidden */
    transition: transform 0.3s ease;
  }

  .sidebar.collapsed {
    transform: translateX(-100%);
  }

  .sidebar:not(.collapsed) ~ .main-content {
    margin-left: 200px; /* Adjust main content when sidebar is open */
  }

  /* Smaller sidebar toggle */
  .sidebar-toggle {
    top: 10px;
    left: 10px;
    padding: 6px;
    font-size: 1rem;
  }

  /* Smaller text */
  body {
    font-size: 14px;
  }

  h1 {
    font-size: 1.5rem;
  }

  .team-card h3 {
    font-size: 1rem;
  }

  .team-card p {
    font-size: 0.8rem;
  }

  /* Team card grid */
  .team-list {
    grid-template-columns: repeat(3, 1fr); /* 3 cards per row by default */
    gap: 8px; /* Smaller gap */
  }

  .sidebar:not(.collapsed) ~ .main-content .team-list {
    grid-template-columns: repeat(2, 1fr); /* 2 cards per row when sidebar is open */
  }

  .team-card {
    padding: 10px; /* Smaller padding */
  }

  /* Hide My Team Box */
  #myTeamBox {
    display: none;
  }

  /* Tap-based popups */
  .team-popup {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 300px;
    background: var(--glass);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 15px;
    backdrop-filter: blur(10px);
    z-index: 1000;
  }

  .team-card {
    cursor: pointer; /* Show tap indication */
  }
/* Stack filters into two rows */
  .filters {
    display: grid;
    grid-template-rows: auto auto; /* Two rows */
    gap: 10px; /* Spacing between rows */
    margin-bottom: 15px; /* Add spacing below filters */
  }

  /* First row: Search and sort */
  .filters > .search-bar {
    grid-row: 1;
    grid-column: 1 / span 2; /* Take up both columns */
    max-width: none; /* Full width */
  }

  .filters > #sortBy {
    grid-row: 1;
    grid-column: 3; /* Place sort dropdown in the third column */
    width: 100%; /* Full width */
  }

  /* Second row: Sport and season filters */
  .filters > #sportFilter,
  .filters > #seasonFilter {
    grid-row: 2;
    width: 100%; /* Full width */
  }

  .filters > #sportFilter {
    grid-column: 1 / span 2; /* Take up two columns */
  }

  .filters > #seasonFilter {
    grid-column: 3; /* Place season filter in the third column */
  }

  /* Adjust search bar and dropdowns */
  .search-bar,
  .filters select {
    width: 100%; /* Full width */
    max-width: none; /* Remove max-width */
    font-size: 14px; /* Smaller text */
    padding: 8px; /* Smaller padding */
  }

  /* Clear search button */
  .clear-search {
    right: 8px; /* Adjust position */
    font-size: 1rem; /* Smaller icon */
  }
}

  </style>
</head>
<body>
<div class="main-content">
<div id="myTeamBox" class="collapsed">
  <button id="toggleMyTeam" onclick="toggleMyTeam()">
    <span class="arrow">◀</span>
  </button>
  <div id="myTeamContent">
    <div class="sport-grid">
        <h3 id="myTeamName">Player 1's Team</h3>
<div class="sport-slot" data-sport="NFL">
  <h4>NFL</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NBA">
  <h4>NBA</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="MLB">
  <h4>MLB</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NHL">
  <h4>NHL</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NCAAF">
  <h4>NCAA Football</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NCAAB">
  <h4>NCAA Basketball</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="Wildcard">
  <h4>Wildcard</h4>
  <div class="slots">
    <div class="slot"></div>
  </div>
</div>
    </div>
  </div>
</div>  <div class="draft-header">
    <h1>Fantasy Fusion Draft</h1>
    <div class="current-player" id="currentPlayerBox">
      <span>On The Clock:</span> <strong>Player 1 - Round 1.1</strong>
    </div>
  </div>
  <div class="draft-status-bar">
    <div class="draft-progress" style="width: 0%"></div>
  </div>
  <div id="app">
    <div class="filters">
  <!-- Search Bar -->
  <div class="search-bar">
    <input type="text" id="teamSearch" placeholder="Search for teams...">
    <button id="clearSearch" class="clear-search">&times;</button>
  </div>
  <!-- Sort By -->
     <label>Sort By:</label>
  <select id="sortBy">
    <option value="championship_odds">Odds</option>
    <option value="adp">ADP</option>
    <option value="lastYearPoints">Prev. Pts</option>
    <option value="championshipPct">% Odds</option> //calculated in database
  </select>
  <!-- Fliter By -->
      <label>Filter:</label>
      <select id="seasonFilter">
        <option value="all">All</option>
        <option value="in-season">In Season</option>
        <option value="off-season">Off Season</option>
      </select>
      <select id="sportFilter">
        <option value="all">All Sports</option>
        <option value="NFL">NFL</option>
        <option value="NBA">NBA</option>
        <option value="MLB">MLB</option>
        <option value="NHL">NHL</option>
        <option value="NCAAF">NCAA Football</option>
        <option value="NCAAB">NCAA Basketball</option>
      </select>
 <!-- Conference Filter -->
  <select id="conferenceFilter" disabled>
    <option value="all">All Conferences</option>
  </select>
    </div>
</div>
    <div class="team-list" id="teamList">
      <!-- Teams will be dynamically inserted here -->
    </div>
  </div>
</div>
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="team-selector">
    <select id="teamSelector" onchange="switchRoster(this.value)">
      <!-- Team options will be dynamically generated here -->
    </select>
  </div>
  <div class="roster-container">
    <!-- Rosters will be dynamically generated here -->
  </div>
</div>
  </div>
</div>

<!-- Sidebar Toggle Button -->
<button class="sidebar-toggle" onclick="toggleSidebar()">
  <span class="arrow">&#9664;</span>
</button>  
<div class="countdown-clock" id="countdownClock"></div>

<div id="teamPopup" class="team-popup">
  <div class="team-popup-content">
    <div class="team-popup-body">
      <p><strong>ADP:</strong> <span id="popupTeamADP"></span></p>
      <p><strong>Odds:</strong> +<span id="popupTeamOdds"></span></p>
      <p><strong>Last Year's Points:</strong> <span id="popupTeamPoints"></span></p>
      <p><strong>Championship %:</strong> <span id="popupTeamChampionshipPct"></span>%</p>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuidv4.min.js"></script>
<script>
// =================================================================================
// DRAFT INITIALIZATION & STATE MANAGEMENT
// =================================================================================

// Initialize Supabase client
const supabaseUrl = 'https://rbumhlgjljzcwaosefif.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJidW1obGdqbGp6Y3dhb3NlZmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDAyNTQxMTYsImV4cCI6MjA1NTgzMDExNn0.wC53zINy4iyxOzMfmqN9xw6Z2-bIjFMblXY95bS3kOQ';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// Global State
const urlParams = new URLSearchParams(window.location.search);
const leagueId = urlParams.get('leagueId');

// A single object to hold all draft state, populated from the database
const draftState = {
    league_name: '',
    team_names: [],
    team_count: 0,
    wildcard_round: 0,
    user_team_name: '',
    current_pick: 0,
    draft_order: [],
    player_rosters: {},
    total_picks: 0,
    timer: null,
    isPaused: false,
};

let DraftableTeams = []; // Holds all draftable teams from the SportTeamDatabase table
let isUserTurn = false;

// =================================================================================
// SCRIPT ENTRY POINT
// =================================================================================

document.addEventListener('DOMContentLoaded', async () => {
    if (!leagueId) {
        alert('No league ID found. Redirecting to setup.');
        window.location.href = 'mock_draft_setup3.html';
        return;
    }

    showLoadingState(true);

    // 1. Fetch all necessary data
    await Promise.all([
        initializeDraftState(),
        fetchDraftableTeamsFromDB()
    ]);
    
    // 2. Set up the UI with the fetched data
    setupInitialUI();
    addEventListeners();
    
    // 3. Start the Draft
    showLoadingState(false);
    checkForNextPick();
});

// =================================================================================
// DATA FETCHING
// =================================================================================

async function initializeDraftState() {
    try {
        const { data: leagueData, error } = await supabase
            .from('mock_drafts')
            .select('*')
            .eq('id', leagueId)
            .single();

        if (error) throw error;
        if (typeof leagueData.draft_order[0] !== 'string') {
            throw new Error("Draft data is invalid. Please create a new draft using the updated setup page.");
        }

        // Populate the global draftState object
        draftState.league_name = leagueData.league_name;
        draftState.team_names = leagueData.team_names || [];
        draftState.team_count = leagueData.team_count;
        draftState.wildcard_round = leagueData.wildcard_round;
        draftState.current_pick = leagueData.current_pick || 0;
        draftState.draft_order = leagueData.draft_order || [];

        const userPosition = leagueData.user_team_position > 0 ? leagueData.user_team_position - 1 : 0;
        draftState.user_team_name = draftState.team_names[userPosition] || '';

        draftState.player_rosters = leagueData.player_rosters && Object.keys(leagueData.player_rosters).length > 0
            ? leagueData.player_rosters
            : initializePlayerRosters(draftState.team_names);

        const totalRounds = 12 + draftState.wildcard_round;
        draftState.total_picks = draftState.team_count * totalRounds;

    } catch (err) {
        alert(err.message);
        console.error('Error initializing draft:', err);
    }
}

async function fetchDraftableTeamsFromDB() {
    try {
        const { data, error } = await supabase
            .from('SportTeamDatabase')
            .select('*');

        if (error) throw error;
        
        // Filter out any teams that have already been drafted
        const pickedTeamIds = new Set();
        Object.values(draftState.player_rosters).forEach(roster => {
            Object.values(roster).forEach(teams => {
                teams.forEach(team => pickedTeamIds.add(team.team_id));
            });
        });

        DraftableTeams = data.filter(team => !pickedTeamIds.has(team.team_id));
        console.log('Available teams loaded from DB:', DraftableTeams.length);

    } catch (err) {
        console.error('Error fetching draftable teams:', err);
    }
}


// =================================================================================
// DRAFT LOGIC & VALIDATION
// =================================================================================

/**
 * Checks if a pick is valid against roster rules.
 * @param {object} team - The team object to be drafted.
 * @param {object} roster - The roster object for the current drafter.
 * @param {number} currentPickNumber - The overall pick number in the draft.
 * @returns {boolean} - True if the pick is valid, false otherwise.
 */
function isPickValid(team, roster, currentPickNumber) {
    const currentRound = Math.floor(currentPickNumber / draftState.team_count) + 1;
    const isWildcardPick = currentRound > 12 && draftState.wildcard_round > 0;

    if (isWildcardPick) {
        // Check if wildcard slots are full
        if (roster.Wildcard && roster.Wildcard.length >= draftState.wildcard_round) {
            return false; // Wildcard slots are full
        }
    } else {
        // Check if the specific sport's slots are full
        if (roster[team.sport] && roster[team.sport].length >= 2) {
            return false; // This sport's roster is full
        }
    }
    return true; // The pick is valid
}

// Main "heartbeat" function of the draft
function checkForNextPick() {
    if (draftState.current_pick >= draftState.total_picks) {
        endDraft();
        return;
    }

    updateOnTheClockUI();
    const currentDrafter = draftState.draft_order[draftState.current_pick];
    isUserTurn = currentDrafter === draftState.user_team_name;

    if (isUserTurn) {
        enableDraftButtons(true);
        startCountdown();
    } else {
        enableDraftButtons(false);
        setTimeout(autoDraftTeam, 1500); // CPU picks after a short delay
    }
}

// Handles the USER's pick selection
async function draftTeam(teamId) {
    if (!isUserTurn) return;

    const team = DraftableTeams.find(t => t.team_id === teamId);
    if (!team) return;

    const draftingTeamName = draftState.draft_order[draftState.current_pick];
    const roster = draftState.player_rosters[draftingTeamName];

    // ***VALIDATION STEP***
    if (!isPickValid(team, roster, draftState.current_pick)) {
        alert(`Cannot draft ${team.name}. Your roster for the ${team.sport} sport is full. Please select a different team.`);
        return; // Stop the function, user remains on the clock
    }

    if (draftState.timer) clearInterval(draftState.timer);
    await processPick(team);
}

// Handles the CPU's auto-pick
function autoDraftTeam() {
    const draftingTeamName = draftState.draft_order[draftState.current_pick];
    const roster = draftState.player_rosters[draftingTeamName];
    
    // Filter for all valid picks based on current roster rules
    const eligibleTeams = DraftableTeams.filter(team => {
        return isPickValid(team, roster, draftState.current_pick);
    });

    if (eligibleTeams.length === 0) {
        console.error("CRITICAL: CPU could not find any valid team to draft. This may indicate an issue with remaining teams or draft logic.");
        processPick(null); // Failsafe: advance draft to prevent it from getting stuck
        return;
    }
    
    const sorted = sortTeams(eligibleTeams, 'championship_odds');
    const teamToDraft = sorted[0];

    console.log(`CPU (${draftingTeamName}) is auto-drafting: ${teamToDraft.name}`);
    processPick(teamToDraft);
}

// Universal function to process a pick once it's been validated/chosen
async function processPick(team) {
    if (team) {
        const draftingTeamName = draftState.draft_order[draftState.current_pick];
        const currentRound = Math.floor(draftState.current_pick / draftState.team_count) + 1;
        const isWildcardPick = currentRound > 12 && draftState.wildcard_round > 0;
        const sportToCredit = isWildcardPick ? 'Wildcard' : team.sport;

        team.round = currentRound;
        team.pick = (draftState.current_pick % draftState.team_count) + 1;
        
        draftState.player_rosters[draftingTeamName][sportToCredit].push(team);
        DraftableTeams = DraftableTeams.filter(t => t.team_id !== team.team_id);
    }

    draftState.current_pick++;
    await saveDraftProgress();
    
    updateAfterPick();
    checkForNextPick();
}

async function saveDraftProgress() {
    try {
        const { error } = await supabase
            .from('mock_drafts')
            .update({
                current_pick: draftState.current_pick,
                player_rosters: draftState.player_rosters,
                status: draftState.current_pick >= draftState.total_picks ? 'completed' : 'in_progress',
                completed_at: draftState.current_pick >= draftState.total_picks ? new Date().toISOString() : null
            })
            .eq('id', leagueId);
        if (error) throw error;
    } catch (err) {
        console.error('Error saving draft progress:', err);
    }
}

function endDraft() {
    if (draftState.timer) clearInterval(draftState.timer);
    alert("Draft Complete! Click OK to view results.");
    document.body.innerHTML = createFinalRosterView();
}


// =================================================================================
// UI & EVENT HANDLERS
// =================================================================================

function setupInitialUI() {
    document.querySelector('.draft-header h1').textContent = `${draftState.league_name} Draft`;
    document.getElementById('myTeamName').textContent = `${draftState.user_team_name}'s Roster`;
    createTeamSidebar();
    renderTeams(); // Initial render of draftable teams
}

function addEventListeners() {
    document.getElementById("sortBy").addEventListener("change", renderTeams);
    document.getElementById("sportFilter").addEventListener("change", renderTeams);
    document.getElementById("seasonFilter").addEventListener("change", renderTeams);
    document.getElementById("teamSearch").addEventListener("input", () => setTimeout(renderTeams, 300));
    document.getElementById("clearSearch").addEventListener("click", () => {
        document.getElementById("teamSearch").value = "";
        renderTeams();
    });
}

function updateAfterPick() {
    updateDraftHeader();
    updateDraftProgress();
    renderTeams(); // Re-render available teams list
    
    const lastDrafterName = draftState.draft_order[draftState.current_pick - 1];
    updateRosterDisplay(lastDrafterName);

    if (lastDrafterName === draftState.user_team_name) {
        // Find the last picked team to update the "My Team" box
        const roster = draftState.player_rosters[lastDrafterName];
        const lastPick = Object.values(roster).flat().sort((a, b) => b.pick - a.pick)[0];
        if (lastPick) updateMyTeamBox(lastPick);
    }
}

function updateOnTheClockUI() {
    updateDraftHeader();
    switchRosterToCurrentPlayer();
}

function updateDraftHeader() {
    if (draftState.current_pick >= draftState.total_picks) {
        document.getElementById('currentPlayerBox').innerHTML = '<strong>Draft Complete</strong>';
        return;
    }
    const teamName = draftState.draft_order[draftState.current_pick];
    const round = Math.floor(draftState.current_pick / draftState.team_count) + 1;
    const pick = (draftState.current_pick % draftState.team_count) + 1;
    document.getElementById('currentPlayerBox').innerHTML = `
        <span>On The Clock:</span>
        <strong>${teamName} - R${round}, P${pick}</strong>
    `;
}

function createTeamSidebar() {
    const rosterContainer = document.querySelector('.roster-container');
    const teamSelector = document.getElementById('teamSelector');
    rosterContainer.innerHTML = '';
    teamSelector.innerHTML = '';

    draftState.team_names.forEach(name => {
        const sanitizedId = name.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
        const option = document.createElement('option');
        option.value = sanitizedId;
        option.textContent = name;
        teamSelector.appendChild(option);

        const rosterEl = document.createElement('div');
        rosterEl.className = 'roster';
        rosterEl.id = `roster-${sanitizedId}`;
        rosterEl.innerHTML = `<h2>${name}</h2><ul id="roster-list-${sanitizedId}"></ul>`;
        rosterContainer.appendChild(rosterEl);
        
        updateRosterDisplay(name);
    });
}

function updateRosterDisplay(teamName) {
    const sanitizedId = teamName.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
    const rosterList = document.getElementById(`roster-list-${sanitizedId}`);
    if (!rosterList) return;

    const roster = draftState.player_rosters[teamName];
    let rosterHTML = '';
    const allSports = ['NFL', 'NBA', 'MLB', 'NHL', 'NCAAF', 'NCAAB'];

    allSports.forEach(sport => {
        const teams = roster[sport] || [];
        rosterHTML += `<strong>${sport}</strong>`;
        teams.forEach(t => rosterHTML += `<li class="${t.sport}">${t.name}</li>`);
        for (let i = 0; i < (2 - teams.length); i++) rosterHTML += `<li class="empty">Empty</li>`;
    });

    if (draftState.wildcard_round > 0) {
        rosterHTML += `<strong>Wildcard</strong>`;
        const wcTeams = roster['Wildcard'] || [];
        wcTeams.forEach(t => rosterHTML += `<li class="${t.sport}">${t.name}</li>`);
        for (let i = 0; i < (draftState.wildcard_round - wcTeams.length); i++) rosterHTML += `<li class="empty">Empty</li>`;
    }
    rosterList.innerHTML = rosterHTML;
}

function updateMyTeamBox(team) {
    const currentRound = team.round;
    const isWildcardPick = currentRound > 12 && draftState.wildcard_round > 0;
    const sportCredited = isWildcardPick ? 'Wildcard' : team.sport;

    const sportSlot = document.querySelector(`.sport-slot[data-sport="${sportCredited}"]`);
    if (!sportSlot) return;

    const emptySlot = sportSlot.querySelector('.slot:not(.filled)');
    if (!emptySlot) return;
    
    const teamIcon = document.createElement('div');
    teamIcon.className = `team-icon ${team.sport}`;
    teamIcon.style.setProperty('--primaryColor', team.primaryColor);
    teamIcon.style.setProperty('--secondaryColor', team.secondaryColor);
    teamIcon.innerHTML = getSportIcon(team);
    emptySlot.innerHTML = '';
    emptySlot.appendChild(teamIcon);
    emptySlot.classList.add('filled');
}

function renderTeams() {
    const teamList = document.getElementById("teamList");
    const sport = document.getElementById("sportFilter").value;
    const sortKey = document.getElementById("sortBy").value;
    const searchQuery = document.getElementById("teamSearch").value.toLowerCase();

    let filteredTeams = DraftableTeams.filter(team => {
        const matchesSport = sport === 'all' || team.sport === sport;
        const matchesSearch = team.name.toLowerCase().includes(searchQuery);
        return matchesSport && matchesSearch;
    });

    const sortedTeams = sortTeams(filteredTeams, sortKey);

    teamList.innerHTML = ""; // Clear list
    sortedTeams.forEach(team => {
        teamList.appendChild(createTeamCard(team));
    });
}

function createTeamCard(team) {
    const teamCard = document.createElement("div");
    teamCard.className = `team-card ${team.sport}`;
    
    teamCard.innerHTML = `
        <h3>${team.name} (${team.sport})</h3>
        <p>Odds: ${team.championship_odds || 'N/A'}</p>
        <button onclick="draftTeam('${team.team_id}')">Draft</button>
    `;
    return teamCard;
}

function enableDraftButtons(isEnabled) {
    document.querySelectorAll('.team-card button').forEach(button => {
        button.disabled = !isEnabled;
    });
}

function showLoadingState(isLoading) {
    document.body.style.cursor = isLoading ? 'wait' : 'default';
    document.body.style.opacity = isLoading ? '0.5' : '1';
}

// =================================================================================
// UTILITY & HELPER FUNCTIONS
// =================================================================================

function initializePlayerRosters(teamNames) {
    const rosters = {};
    teamNames.forEach(name => {
        rosters[name] = { NFL: [], NBA: [], MLB: [], NHL: [], NCAAF: [], NCAAB: [], Wildcard: [] };
    });
    return rosters;
}

function switchRosterToCurrentPlayer() {
    if (draftState.current_pick >= draftState.total_picks) return;
    const currentTeamName = draftState.draft_order[draftState.current_pick];
    if (typeof currentTeamName !== 'string') return;
    const sanitizedId = currentTeamName.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '');
    document.getElementById('teamSelector').value = sanitizedId;
    switchRoster(sanitizedId);
}

function switchRoster(sanitizedId) {
    document.querySelectorAll(".roster").forEach(r => r.classList.remove('active'));
    document.getElementById(`roster-${sanitizedId}`)?.classList.add('active');
}

function startCountdown() {
    if (draftState.timer) clearInterval(draftState.timer);
    let timeLeft = 120;
    const timerElement = document.getElementById('countdownClock');
    timerElement.textContent = "2:00";
    
    draftState.timer = setInterval(() => {
        if (timeLeft <= 0) {
            clearInterval(draftState.timer);
            autoDraftTeam();
            return;
        }
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.textContent = `${minutes}:${String(seconds).padStart(2, '0')}`;
    }, 1000);
}

function updateDraftProgress() {
    const progress = (draftState.current_pick / draftState.total_picks) * 100;
    document.querySelector('.draft-progress').style.width = `${progress}%`;
}

function createFinalRosterView() {
    let rostersHTML = '';
    draftState.team_names.forEach(name => {
        const roster = draftState.player_rosters[name];
        rostersHTML += `<div class="roster" style="display:block; background:rgba(26, 26, 26, 0.8); padding:20px; border-radius:12px;"><h2>${name}</h2><ul>`;
        for (const sport in roster) {
            if (roster[sport] && roster[sport].length > 0) {
                rostersHTML += `<strong>${sport}</strong>`;
                roster[sport].forEach(team => {
                    rostersHTML += `<li>${team.name}</li>`;
                });
            }
        }
        rostersHTML += `</ul></div>`;
    });
    const finalStyles = `<style>body{display:flex;flex-direction:column;align-items:center;background:#0A0A0A;color:#FFF;font-family:'Inter',sans-serif;}.final-container{display:flex;flex-wrap:wrap;gap:20px;justify-content:center;padding:20px;max-width:1400px;}.roster{width:300px;border:1px solid #333}.roster h2{text-align:center;color:#D2042D;}.roster ul{list-style:none;padding:0;}.roster li{background:#1A1A1A;padding:8px;border-radius:4px;margin-bottom:5px;}.roster strong{display:block;margin-top:10px;color:#aaa;font-size:0.9em;}</style>`;
    return `${finalStyles}<h1>Draft Complete!</h1><div class="final-container">${rostersHTML}</div>`;
}

// Basic utility functions
function getSportIcon(team) { switch(team.sport){case"NBA":case"NCAAB":return`<i class="fa-solid fa-basketball"></i>`;case"NFL":case"NCAAF":return`<i class="fa-solid fa-football"></i>`;case"MLB":return`<i class="fa-solid fa-baseball"></i>`;case"NHL":return`<i class="fa-solid fa-hockey-puck"></i>`;default:return""} }
function sortTeams(teams, sortKey) { return teams.sort((a,b)=>{const propA=a[sortKey]||0;const propB=b[sortKey]||0;if(sortKey==='championship_odds'){return propA-propB}return propB-propA}); }
function toggleSidebar() { document.getElementById("sidebar").classList.toggle("collapsed"); }
function toggleMyTeam() { document.getElementById("myTeamBox").classList.toggle("collapsed"); }

</script>
</body>
</html>
