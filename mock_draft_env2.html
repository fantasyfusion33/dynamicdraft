<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fantasy Draft Board</title>
  <style>
    /* Modern Professional Design */
    :root {
      --primary: #D2042D;
      --dark: #0A0A0A;
      --light: #FFFFFF;
      --gray: #1A1A1A;
      --glass: rgba(26, 26, 26, 0.8);
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--dark);
      color: var(--light);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .countdown-clock {
      position: fixed;
      top: 40px;
      left: calc(350px + 45px); /* Sidebar (350px) + 35px */
      width: 75px;
      font-size: 2rem;
      font-weight: 600;
      background: var(--glass);
      padding: 12px 20px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 300;
    }

    /* When the sidebar is collapsed, move the clock 35px from the left */
    .sidebar.collapsed ~ .countdown-clock {
     left: 45px;
    }

    .draft-header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 2rem 0;
      background: linear-gradient(135deg, var(--dark) 0%, #1a1a1a 100%);
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }

    .draft-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, rgba(210, 4, 45, 0.1) 0%, rgba(210, 4, 45, 0.05) 100%);
    }

    .current-player {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--light);
      padding: 12px 24px;
      background: var(--primary);
      border-radius: 8px;
      display: inline-block;
      backdrop-filter: blur(10px);
      margin: 1rem 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .current-player span {
      font-weight: 400;
      color: rgba(255, 255, 255, 0.8);
    }

    .current-player strong {
      font-weight: 700;
    }

   /* Filters and Search Bar */
.filters {
  display: flex;
  align-items: center;
  gap: 20px; /* Ensures even spacing */
  margin-bottom: 20px;
  padding-left: 10px; /* Adds space from the left edge */
}

.search-bar {
  position: relative;
  flex: 1;
  max-width: 200px;
  min-width: 200px;
  margin-left: 10px; /* Adds space between the search bar and left-most filter */
}

#teamSearch {
  width: 80%;
  padding: 8px 30px 8px 12px;
  background: var(--gray);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  color: var(--light);
  font-size: 14px;
}

.clear-search {
  position: absolute;
  right: 9px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  padding: 0;
  font-size: 1.2rem;
}

.clear-search:hover {
  color: var(--primary);
}

.filters select {
  padding: 10px 16px;
  background: var(--gray);
  color: var(--light);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.2s ease;
}

/* Ensures search bar and filters don't overlap */
.filters select:first-child {
  margin-right: 15px; /* Adds space between left-most filter and search bar */
}

.filters select:hover {
  border-color: var(--primary);
}

    .team-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 2rem;
    }

    .team-card {
      background: var(--glass);
      padding: 20px;
      border-radius: 12px;
      position: relative;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      z-index: 200;
    }

.team-card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}
    .team-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .team-card.NFL { border-left: 4px solid #8A2BE2; }
    .team-card.NBA { border-left: 4px solid #FF69B4; }
    .team-card.MLB { border-left: 4px solid #4169E1; }
    .team-card.NHL { border-left: 4px solid #FFA500; }
    .team-card.NCAAF { border-left: 4px solid #32CD32; }
    .team-card.NCAAB { border-left: 4px solid #FFD700; }

    .team-card h3 {
      margin: 0 0 8px;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--light);
    }

    .team-card p {
      margin: 4px 0;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .team-card button {
      margin-top: 16px;
      width: 100%;
      padding: 10px;
      background: var(--primary);
      color: var(--light);
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .team-card button:disabled {
      background: rgba(210, 4, 45, 0.3);
      cursor: not-allowed;
      opacity: 0.7;
    }

    .team-card button:hover:not(:disabled) {
      background: #B00326;
      transform: translateY(-1px);
    }

    .flag {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 6px;
      right: 6px;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 500;
      z-index: 1;
      line-height: 1.2;
      text-align: center;
    }

    .flag.in-season { background: rgba(0, 255, 0, 0.15); color: #00FF00; }
    .flag.off-season { background: rgba(255, 0, 0, 0.15); color: #FF4444; }

    .rosters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-top: 2rem;
    }

    .roster {
      background: var(--glass);
      padding: 20px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 100;
    }

    .roster h2 {
      margin: 0 0 16px;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--light);
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-transform: uppercase;
      letter-spacing: 1px;
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      border-radius: 6px;
      z-index: 100;

    }

    .roster ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .roster li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.03);
    }
    /* Add these styles to your CSS */
    .roster li strong {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--light);
      background: rgba(255, 255, 255, 0.1);
      padding: 8px;
      border-radius: 6px;
      display: block;
      margin: 8px 0;
    }

    .roster li:last-child {
      border-bottom: none;
    }

    .roster li.NFL { border-left: 4px solid #8A2BE2; }
    .roster li.NBA { border-left: 4px solid #FF69B4; }
    .roster li.MLB { border-left: 4px solid #4169E1; }
    .roster li.NHL { border-left: 4px solid #FFA500; }
    .roster li.NCAAF { border-left: 4px solid #32CD32; }
    .roster li.NCAAB { border-left: 4px solid #FFD700; }

    .draft-pick-circle {
      background: var(--primary);
      color: var(--light);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .draft-pick-circle.NFL { background: #8A2BE2; }
    .draft-pick-circle.NBA { background: #FF69B4; }
    .draft-pick-circle.MLB { background: #4169E1; }
    .draft-pick-circle.NHL { background: #FFA500; }
    .draft-pick-circle.NCAAF { background: #32CD32; }
    .draft-pick-circle.NCAAB { background: #FFD700; }

    .draft-status-bar {
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      margin: 20px 0;
      position: relative;
    }

    .draft-progress {
      height: 100%;
      background: var(--primary);
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    @keyframes pulse-glow {
      0% { box-shadow: 0 0 0 0 rgba(210, 4, 45, 0.4); }
      100% { box-shadow: 0 0 0 6px rgba(210, 4, 45, 0); }
    }

    .urgent {
      animation: pulse-glow 1.5s infinite;
    }

.draft-complete {
  margin: 0 !important; /* Remove default margins */
  padding: 20px !important; /* Add padding for spacing */
  width: 100% !important; /* Ensure full width */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--dark); /* Match the background color */
}

.draft-complete-container {
  padding: 20px;
  overflow-y: auto;
  height: calc(100vh - 120px);
  scrollbar-width: none; /* Firefox */
}

.draft-complete-container::-webkit-scrollbar {
  display: none; /* Chrome, Safari */
}

.final-rosters {
  display: flex;
  justify-content: center;
  gap: 25px;
  width: 100%;
}

.final-rosters .roster {
  display: block; /* Change from flex to block */
  width: 350px;
  background: var(--glass);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.final-rosters .roster h2 {
  text-align: center; /* Center the title */
  margin-bottom: 20px; /* Add space below the title */
}

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 350px;
      height: 100vh;
      background: var(--glass);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 4px 0 12px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
      z-index: 100;
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar-toggle {
      position: fixed;
      top: 20px;
      left: 350px;
      background: var(--primary);
      color: var(--light);
      border: none;
      padding: 10px;
      border-radius: 0 6px 6px 0;
      cursor: pointer;
      transition: left 0.3s ease;
      z-index: 300;
    }

    .sidebar.collapsed + .sidebar-toggle {
      left: 0px;
      transform: translateX(-100); /* Ensure button stays visible */
    }

    .sidebar-toggle .arrow {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .sidebar.collapsed .sidebar-toggle .arrow {
      transform: rotate(180deg);
    }

    .team-selector {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .team-selector select {
      width: 100%;
      padding: 10px;
      background: var(--gray);
      color: var(--light);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .team-selector select:hover {
      border-color: var(--primary);
    }

   .roster-container {
     padding: 20px;
     overflow-y: auto;
     height: calc(100vh - 120px);
     scrollbar-width: none; /* Firefox */
   }

   .roster-container::-webkit-scrollbar {
     display: none; /* Chrome, Safari */
   }


    .roster {
      display: none;
    }

    .roster.active {
      display: block;
    }

    .main-content {
      margin-left: 350px;
      transition: margin-left 0.3s ease;
    }

    .sidebar.collapsed ~ .main-content {
      margin-left: 0;
    }
.team-icon {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primaryColor);
  position: relative;
  margin-right: 8px;
}

.team-icon i {
  font-size: 20px; /* Adjust icon size */
  color: var(--secondaryColor); /* Use secondary color for the icon */
}
/* MyTeam Box */
#myTeamBox {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 275px;
  height: 200px;
  background: #333; /* Dark gray background */
  padding: 16px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 300;
  transition: transform 0.3s ease;
}

#myTeamContent h3 {
  text-align: center; /* Center text horizontally */
  display: flex;
  align-items: center; /* Center text vertically */
  justify-content: center; /* Center horizontally */
  height: 50px; /* Adjust based on available space */
  margin: 0; /* Remove default margins */
}


#myTeamBox.collapsed {
  transform: translateX(calc(100% - 40px)); /* Collapse to the right */
}

#myTeamBox.collapsed #myTeamContent {
  display: none; /* Hide content when collapsed */
}

#toggleMyTeam {
  position: absolute;
  top: 10px;
  left: -38px;
  background: #D2042D; /* Primary color */
  color: #FFF;
  border: none;
  padding: 8px 12px; /* Wider padding for better click area */
  border-radius: 6px 0 0 6px; /* Rounded corners on the left */
  cursor: pointer;
  font-size: 16px; /* Adjust arrow size */
  display: flex;
  align-items: center;
  justify-content: center;
}

#toggleMyTeam .arrow {
  transition: transform 0.3s ease;
}

#myTeamBox.collapsed #toggleMyTeam .arrow {
  transform: rotate(0deg); /* Arrow pointing left (◀) */
}

#myTeamBox:not(.collapsed) #toggleMyTeam .arrow {
  transform: rotate(180deg); /* Arrow pointing right (▶) */
}

.sport-grid {
  display: grid;
  margin-top: -10px;
  grid-template-columns: repeat(2, 1fr);
  gap: 1px;
}

.sport-slot h4 {
  margin: 0 0 0px;
  font-size: 14px;
  color: #FFF;
  text-align: center;
}

.sport-slot:nth-child(2n) { /* Selects every second item (right column) */
  margin-top: 4px;
}

.slots {
  display: flex;
  gap: 8px;
  justify-content: center;
}

/* My Team Box Slots */
.slot {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1); /* Light gray for empty slots */
  display: block;
  align-items: center;
  justify-content: center;
  transition: background 0.3s ease;
  position: relative; /* For positioning */
}

/* Team Icons */
.team-icon {
  width: 32px; /* Ensure width matches slot size */
  height: 32px; /* Ensure height matches slot size */
  border-radius: 50%; /* Make it a perfect circle */
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primaryColor); /* Use team's primary color */
}

.team-icon i {
  font-size: 20px; /* Adjust icon size to fit inside the circle */
  color: var(--secondaryColor); /* Use team's secondary color */
}

/* Filled Slot Styling */
.slot.filled {
  background: transparent; /* Remove gray background when filled */
}


/* Responsive adjustments */
@media (max-width: 768px) {
  #myTeamBox {
    transform: translateX(calc(100% - 40px)); /* Collapse by default on small screens */
  }

  #myTeamBox.collapsed {
    transform: translateX(0); /* Expand when toggled */
  }
}

/* Team Popup Styles */
.team-popup {
  display: none;
  position: fixed;
  background: var(--glass);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 16px;
  backdrop-filter: blur(10px);
  z-index: 300;
  width: 150px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.team-popup-content {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.team-popup-body p {
  margin: 4px 0;
  font-size: 0.9rem;
}

.wildcard-badge {
  display: inline-block;
  background: #FFD700;
  color: #000;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.8rem;
  margin-left: 8px;
}

/* Mobile Styles (applied when screen width is less than 768px) */
@media (max-width: 768px) {
  /* Shrink clock */
  .countdown-clock {
    top: 10px;
    left: 10px;
    font-size: 1.2rem;
    padding: 6px 12px;
    width: 60px;
  }

  /* Smaller sidebar */
  .sidebar {
    width: 200px; /* Narrower sidebar */
    transform: translateX(-100%); /* Start hidden */
    transition: transform 0.3s ease;
  }

  .sidebar.collapsed {
    transform: translateX(-100%);
  }

  .sidebar:not(.collapsed) ~ .main-content {
    margin-left: 200px; /* Adjust main content when sidebar is open */
  }

  /* Smaller sidebar toggle */
  .sidebar-toggle {
    top: 10px;
    left: 10px;
    padding: 6px;
    font-size: 1rem;
  }

  /* Smaller text */
  body {
    font-size: 14px;
  }

  h1 {
    font-size: 1.5rem;
  }

  .team-card h3 {
    font-size: 1rem;
  }

  .team-card p {
    font-size: 0.8rem;
  }

  /* Team card grid */
  .team-list {
    grid-template-columns: repeat(3, 1fr); /* 3 cards per row by default */
    gap: 8px; /* Smaller gap */
  }

  .sidebar:not(.collapsed) ~ .main-content .team-list {
    grid-template-columns: repeat(2, 1fr); /* 2 cards per row when sidebar is open */
  }

  .team-card {
    padding: 10px; /* Smaller padding */
  }

  /* Hide My Team Box */
  #myTeamBox {
    display: none;
  }

  /* Tap-based popups */
  .team-popup {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 300px;
    background: var(--glass);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 15px;
    backdrop-filter: blur(10px);
    z-index: 1000;
  }

  .team-card {
    cursor: pointer; /* Show tap indication */
  }
/* Stack filters into two rows */
  .filters {
    display: grid;
    grid-template-rows: auto auto; /* Two rows */
    gap: 10px; /* Spacing between rows */
    margin-bottom: 15px; /* Add spacing below filters */
  }

  /* First row: Search and sort */
  .filters > .search-bar {
    grid-row: 1;
    grid-column: 1 / span 2; /* Take up both columns */
    max-width: none; /* Full width */
  }

  .filters > #sortBy {
    grid-row: 1;
    grid-column: 3; /* Place sort dropdown in the third column */
    width: 100%; /* Full width */
  }

  /* Second row: Sport and season filters */
  .filters > #sportFilter,
  .filters > #seasonFilter {
    grid-row: 2;
    width: 100%; /* Full width */
  }

  .filters > #sportFilter {
    grid-column: 1 / span 2; /* Take up two columns */
  }

  .filters > #seasonFilter {
    grid-column: 3; /* Place season filter in the third column */
  }

  /* Adjust search bar and dropdowns */
  .search-bar,
  .filters select {
    width: 100%; /* Full width */
    max-width: none; /* Remove max-width */
    font-size: 14px; /* Smaller text */
    padding: 8px; /* Smaller padding */
  }

  /* Clear search button */
  .clear-search {
    right: 8px; /* Adjust position */
    font-size: 1rem; /* Smaller icon */
  }
}

  </style>
</head>
<body>
<div class="main-content">
<div id="myTeamBox" class="collapsed">
  <button id="toggleMyTeam" onclick="toggleMyTeam()">
    <span class="arrow">◀</span>
  </button>
  <div id="myTeamContent">
    <div class="sport-grid">
    <h3>Player 1's Team</h3>
<div class="sport-slot" data-sport="NFL">
  <h4>NFL</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NBA">
  <h4>NBA</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="MLB">
  <h4>MLB</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NHL">
  <h4>NHL</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NCAAF">
  <h4>NCAA Football</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="NCAAB">
  <h4>NCAA Basketball</h4>
  <div class="slots">
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>
<div class="sport-slot" data-sport="Wildcard">
  <h4>Wildcard</h4>
  <div class="slots">
    <div class="slot"></div>
  </div>
</div>
    </div>
  </div>
</div>  <div class="draft-header">
    <h1>Fantasy Fusion Draft</h1>
    <div class="current-player" id="currentPlayerBox">
      <span>On The Clock:</span> <strong>Player 1 - Round 1.1</strong>
    </div>
  </div>
  <div class="draft-status-bar">
    <div class="draft-progress" style="width: 0%"></div>
  </div>
  <div id="app">
    <div class="filters">
  <!-- Search Bar -->
  <div class="search-bar">
    <input type="text" id="teamSearch" placeholder="Search for teams...">
    <button id="clearSearch" class="clear-search">&times;</button>
  </div>
  <!-- Sort By -->
     <label>Sort By:</label>
  <select id="sortBy">
    <option value="championship_odds">Odds</option>
    <option value="adp">ADP</option>
    <option value="lastYearPoints">Prev. Pts</option>
    <option value="championshipPct">% Odds</option>
  </select>
  <!-- Fliter By -->
      <label>Filter:</label>
      <select id="seasonFilter">
        <option value="all">All</option>
        <option value="in-season">In Season</option>
        <option value="off-season">Off Season</option>
      </select>
      <select id="sportFilter">
        <option value="all">All Sports</option>
        <option value="NFL">NFL</option>
        <option value="NBA">NBA</option>
        <option value="MLB">MLB</option>
        <option value="NHL">NHL</option>
        <option value="NCAAF">NCAA Football</option>
        <option value="NCAAB">NCAA Basketball</option>
      </select>
 <!-- Conference Filter -->
  <select id="conferenceFilter" disabled>
    <option value="all">All Conferences</option>
  </select>
    </div>
</div>
    <div class="team-list" id="teamList">
      <!-- Teams will be dynamically inserted here -->
    </div>
  </div>
</div>
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="team-selector">
    <select id="teamSelector" onchange="switchRoster(this.value)">
      <!-- Team options will be dynamically generated here -->
    </select>
  </div>
  <div class="roster-container">
    <!-- Rosters will be dynamically generated here -->
  </div>
</div>
  </div>
</div>

<!-- Sidebar Toggle Button -->
<button class="sidebar-toggle" onclick="toggleSidebar()">
  <span class="arrow">&#9664;</span>
</button>  
<div class="countdown-clock" id="countdownClock"></div>

<div id="teamPopup" class="team-popup">
  <div class="team-popup-content">
    <div class="team-popup-body">
      <p><strong>ADP:</strong> <span id="popupTeamADP"></span></p>
      <p><strong>Odds:</strong> +<span id="popupTeamOdds"></span></p>
      <p><strong>Last Year's Points:</strong> <span id="popupTeamPoints"></span></p>
      <p><strong>Championship %:</strong> <span id="popupTeamChampionshipPct"></span>%</p>
    </div>
  </div>
</div>
<div id="admin-controls" class="admin-only" style="display: none;">
  <button onclick="pauseDraft()">⏸️ Pause</button>
  <button onclick="redoPick()">↩️ Redo Pick</button>
  <button onclick="advancePick()">⏭️ Next Pick</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuidv4.min.js"></script>
<script>
// ========================
// Supabase Client Setup
// ========================
const supabaseUrl = 'https://rbumhlgjljzcwaosefif.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJidW1obGdqbGp6Y3dhb3NlZmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDAyNTQxMTYsImV4cCI6MjA1NTgzMDExNn0.wC53zINy4iyxOzMfmqN9xw6Z2-bIjFMblXY95bS3kOQ';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// ========================
// Global State
// ========================
let draftState = {
  // From Supabase
  id: null,
  league_name: "",
  team_names: [],
  draft_order: [],
  current_pick: 0,
  is_paused: false,
  player_rosters: {},
  status: "pre_draft",
  user_team_position: 0,
  wildcard_round: false,
  team_count: 0,
  
  // Derived values
  total_picks: 0,
  timer: null,
  channel: null
};

let DraftableTeams = [];
let leagueId = new URLSearchParams(window.location.search).get('leagueId');

// ========================
// Initialization
// ========================
function initializeRosters() {
  draftState.player_rosters = {};
  const sports = ['NFL', 'NBA', 'MLB', 'NHL', 'NCAAF', 'NCAAB'];
  
  for (let i = 0; i < draftState.team_count; i++) {
    draftState.player_rosters[i] = {
      NFL: [],
      NBA: [],
      MLB: [],
      NHL: [],
      NCAAF: [],
      NCAAB: [],
      wildcard: []
    };
  }
}
  
async function initializeDraft() {
  if (!leagueId) {
    alert('Missing league ID in URL');
    return;
  }

  try {
    // 1. Load draft data
    const { data, error } = await supabase
      .from('mock_drafts')
      .select('*')
      .eq('id', leagueId)
      .single();

    if (error) throw error;

    // 2. Initialize state
    draftState = {
      ...draftState,
      ...data,
    current_pick: data.current_pick < 1 ? 1 : data.current_pick, // Force minimum 1
      total_picks: (data.wildcard_round ? 13 : 12) * data.team_count,
    };
      // Explicitly set pick 1 in database if missing
  if (draftState.current_pick !== data.current_pick) {
    await supabase
      .from('mock_drafts')
      .update({ current_pick: 0 })
      .eq('id', leagueId);
  }

    initializeRosters();

  function initializeToggles() {
  // My Team toggle
  document.getElementById('toggleMyTeam').addEventListener('click', function(e) {
    e.stopPropagation();
    toggleMyTeam();
  });

  // Sidebar toggle
  document.querySelector('.sidebar-toggle').addEventListener('click', function(e) {
    e.stopPropagation();
    toggleSidebar();
  });
}
  // Initialize roster switching
  document.getElementById('teamSelector')?.addEventListener('change', (e) => {
    switchRoster(e.target.value);
  });
  
  // Show first roster by default
  switchRoster('player1'); 
    
    // 4. Load team data
    await loadTeamData();

    // 5. Set up real-time updates
    draftState.channel = subscribeToUpdates();

    // 6. Initial render
    renderDraftBoard();
    initializeSidebar();
    initializeMyTeamBox();
    if (draftState.current_pick === 0) {
    draftState.current_pick = 1;
    await saveDraftState();
    }
    startCountdown();

  } catch (err) {
    console.error("Initialization failed:", err);
    alert("Failed to load draft. Please refresh.");
  }
  
}

async function loadTeamData() {
  return new Promise((resolve) => {
    Papa.parse("SportTeamDatabase_rows.csv", {
      download: true,
      header: true,
      complete: (results) => {
        DraftableTeams = results.data || [];
        resolve();
      },
      error: (error) => {
        console.error("CSV load failed:", error);
        resolve();
      }
    });
  });
}

// ========================
// Real-Time Updates
// ========================
function subscribeToUpdates() {
  return supabase
    .channel('draft_updates')
    .on('postgres_changes', {
      event: 'UPDATE',
      schema: 'public',
      table: 'mock_drafts',
      filter: `id=eq.${draftState.id}`
    }, (payload) => {
      draftState = payload.new;
      renderDraftBoard();
    })
    .subscribe();
}

// ========================
// Core Draft Logic
// ========================
async function draftTeam(teamId) {
  const round = Math.floor((draftState.current_pick - 1) / draftState.team_count) + 1;
  const isWildcardRound = draftState.wildcard_round && round > 12;
  const currentTeamIndex = (draftState.current_pick - 1) % draftState.team_count;
  const roster = draftState.player_rosters[currentTeamIndex]; // Fixed indexing
  
  // Create DEEP COPY of team object
  const team = JSON.parse(JSON.stringify(
    DraftableTeams.find(t => t.team_id === teamId)
  ));
  
  // Add pick metadata
  team.round = Math.floor((draftState.current_pick - 1) / draftState.team_count) + 1;
  team.pick = ((draftState.current_pick - 1) % draftState.team_count) + 1;
  
  // Add to roster
  if (isWildcardRound) {
    roster.wildcard.push(team);
  } else {
    roster[team.sport].push(team); // Now safe
  }

  // Validate pick
  // Get current count for this sport
  const sport = team.sport;
  const currentCount = roster[sport]?.length || 0;

  // Validate only if not wildcard round
  if (!isWildcardRound && currentCount >= 2) {
    return alert(`Maximum 2 ${sport} teams allowed!`);
  }

  // Update the sidebar to show the current drafting team
const updateSidebar = (currentPlayer) => {
  const teamSelector = document.getElementById("teamSelector");
  teamSelector.value = `player${currentPlayer}`;
  switchRoster(`player${currentPlayer}`);
};

  //debugging step
console.log("Drafting team:", teamId, 
  "for index:", currentTeamIndex,
  "Roster:", JSON.parse(JSON.stringify(roster)));
  
  // Update UI and advance
  DraftableTeams = DraftableTeams.filter(t => t.team_id !== teamId);
  await saveDraftState();
  advanceDraft();
}

function advanceDraft() {
  
  // Update team selector
  const currentTeamIndex = draftState.draft_order[draftState.current_pick];
  document.getElementById('teamSelector').value = `player${currentTeamIndex + 1}`;
  document.querySelectorAll('.sidebar-team-list li').forEach(li => {
    li.classList.toggle('active', 
      parseInt(li.dataset.teamIndex) === currentTeamIndex
    );
  });
  draftState.current_pick++;

  // Wildcard round alert
  if (draftState.current_pick === 12 * draftState.team_count && draftState.wildcard_round) {
    alert("Wildcard Round: Draft any team!");
  }

  // End condition
  if (draftState.current_pick >= draftState.total_picks) {
    endDraft();
    return;
  }

  renderDraftBoard();
  resetCountdown();
}

// ========================
// Timer Functions
// ========================
function startCountdown() {
  let timeLeft = 120; // 2 minutes
  
  draftState.timer = setInterval(() => {
    timeLeft--;
    
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    document.getElementById('countdownClock').textContent = 
      `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    
    updateDraftProgress(); // Update progress bar urgency
    
    if (timeLeft <= 0) {
      clearInterval(draftState.timer);
      autoDraftTeam();
    }
  }, 1000);
}

function resetCountdown() {
  clearInterval(draftState.timer);
  startCountdown();
}

// ========================
// Auto-Draft Logic
// ========================
function autoDraftTeam() {
  const currentPlayerNum = draftState.draft_order[draftState.current_pick];
  const roster = draftState.player_rosters[currentPlayerNum];
  const isWildcardRound = draftState.current_pick >= 12 * draftState.team_count;

  // Filter available teams
  const eligibleTeams = DraftableTeams.filter(team => {
    if (isWildcardRound) return true;
    return roster[team.sport].length < 2;
  });

  // Sort by best available (using championship odds)
  const bestTeam = eligibleTeams.sort((a, b) => 
    a.championship_odds - b.championship_odds
  )[0];

  if (bestTeam) {
    draftTeam(bestTeam.team_id);
  } else {
    console.warn("No teams available for auto-draft");
    advanceDraft();
  }
}

// ========================
// UI Rendering
// ========================
function renderDraftBoard() {
  // 1. Update header
  updateDraftHeader();

  // 2. Render team list
  renderTeamList();

  // 3. Update rosters
  renderAllRosters();

  // 4. Update progress
  updateDraftProgress();

  // 5. Update My Team box
  updateMyTeamBox();
}

function updateDraftHeader() {
  // Use pick-1 for calculations (fixes off-by-one error)
  const displayPick = Math.max(draftState.current_pick, 1);
  const currentTeamIndex = (displayPick - 1) % draftState.team_count;
  const teamName = draftState.team_names[currentTeamIndex] || `Team ${currentTeamIndex + 1}`;
  
  // Calculate round (1-12) and pick-in-round (1-12)
  const round = Math.floor((displayPick - 1) / draftState.team_count) + 1;
  const pickInRound = (displayPick - 1) % draftState.team_count + 1;

  // Handle wildcard round
  const isWildcardRound = draftState.wildcard_round && round > 12;

  document.getElementById('currentPlayerBox').innerHTML = `
    <span>On The Clock:</span>
    <strong>${teamName} - ${isWildcardRound ? 
      'Wildcard Round' : 
      `Round ${round}.${pickInRound}`}
    </strong>
  `;
}
  
function renderTeamList() {
  const filteredTeams = filterTeams();
  const sortedTeams = sortTeams(filteredTeams, document.getElementById('sortBy').value);  
  teamList.innerHTML = sortedTeams.map(team => `
    <div class="team-card ${team.sport}" data-team-id="${team.team_id}">
      <div class="flag ${String(team.season_year).startsWith("2024") ? 'in-season' : 'off-season'}">
        ${String(team.season_year).startsWith("2024") ? 'In Season' : 'Off Season'}
      </div>
      <div class="team-card-header">
        <div class="team-icon ${team.sport}" 
             style="--primaryColor: ${team.primaryColor}; 
                    --secondaryColor: ${team.secondaryColor};"> 
          ${getSportIcon(team)}
        </div>
        <h3>${team.name}</h3>
      </div>
      <p>${team.sport} (${team.season_year})</p>
      <p>${team.conference || team.league} ${team.division ? `${team.division}` : ''}</p>
      <p>${formatTeamInfo(team, document.getElementById('sortBy').value)}</p>
      <button onclick="draftTeam('${team.team_id}')">Draft</button>
    </div>
  `).join('');
}

function generateRosterHTML(playerNum, roster) {
  return `
    <h2>${draftState.team_names[playerNum]}</h2>
    <ul>
      ${Object.entries(roster)
        .filter(([sport]) => sport !== 'wildcard')
        .map(([sport, teams]) => `
          <strong>${sport}</strong>
          ${teams.map(team => `
            <li class="${team.sport}">
              ${team.name}
              <div class="draft-pick-circle ${team.sport}">
                ${team.round}.${team.pick}
              </div>
            </li>
          `).join('')}
          ${Array(2 - teams.length).fill('<li class="empty">Empty</li>').join('')}
        `).join('')}
      ${roster.wildcard?.length ? `
        <strong>Wildcard</strong>
        <li class="${roster.wildcard[0].sport}">
          ${roster.wildcard[0].name}
          <div class="draft-pick-circle">
            13.${roster.wildcard[0].pick}
          </div>
        </li>
      ` : '<li class="empty">Empty</li>'}
    </ul>
  `;
}

function renderAllRosters() {
  Object.keys(draftState.player_rosters).forEach(playerNum => {
    const rosterEl = document.getElementById(`player${playerNum}Roster`);
    if (rosterEl) {
      rosterEl.innerHTML = generateRosterHTML(
        parseInt(playerNum), 
        draftState.player_rosters[playerNum]
      );
    }
  });
}

function updateDraftProgress() {
  const progressPercent = (draftState.current_pick / draftState.total_picks) * 100;
  document.querySelector('.draft-progress').style.width = `${progressPercent}%`;
  
  // Add urgent class when time is running low
  const clock = document.getElementById('countdownClock');
  if (clock && clock.textContent.includes('0:30')) {
    clock.classList.add('urgent');
  } else {
    clock?.classList.remove('urgent');
  }
}

function updateMyTeamBox() {
  const userTeamIndex = draftState.user_team_position;
  const roster = draftState.player_rosters[userTeamIndex];
  const teamName = draftState.team_names[userTeamIndex];
  
  // Update title
  document.querySelector('#myTeamContent h3').textContent = `${teamName}'s Team`;
  
  if (!roster) {
    console.error("No roster found for user team:", userTeamIndex);
    return;
  }

  // Update all sports
  const sports = ['NFL', 'NBA', 'MLB', 'NHL', 'NCAAF', 'NCAAB', 'wildcard'];
  sports.forEach(sport => {
    const container = document.querySelector(`.sport-slot[data-sport="${sport}"]`);
    if (!container) return;
    
    const slots = container.querySelectorAll('.slot');
    const teams = roster[sport] || [];
    
    slots.forEach((slot, index) => {
      slot.innerHTML = '';
      slot.classList.remove('filled');
      
      if (teams[index]) {
        const team = teams[index];
        slot.innerHTML = `
          <div class="team-icon ${team.sport}" 
               style="--primaryColor: ${team.primaryColor}; 
                      --secondaryColor: ${team.secondaryColor}">
            ${getSportIcon(team)}
          </div>
        `;
        slot.classList.add('filled');
      }
    });
  });
}
  
// ========================
// Utility Functions
// ========================
function filterTeams() {
  const seasonFilter = document.getElementById('seasonFilter').value;
  const sportFilter = document.getElementById('sportFilter').value;
  const searchQuery = document.getElementById('teamSearch').value.toLowerCase();

  return DraftableTeams.filter(team => {
    const isCurrentSeason = String(team.season_year).startsWith("2024");
    const matchesSeason = seasonFilter === "all" || 
                         (seasonFilter === "in-season" && isCurrentSeason) || 
                         (seasonFilter === "off-season" && !isCurrentSeason);
    
    const matchesSport = sportFilter === "all" || team.sport === sportFilter;
    const matchesSearch = team.name.toLowerCase().includes(searchQuery);

    return matchesSeason && matchesSport && matchesSearch;
  });
}

const sortTeams = (DraftableTeams, sortKey) => {
  // Create a copy to avoid mutating the original array
  return [...DraftableTeams].sort((a, b) => {
    // Handle "No Odds" or championshipPct = 0
    const aHasOdds = a.championshipPct > 0;
    const bHasOdds = b.championshipPct > 0;

    // If one team has odds and the other doesn't, prioritize the one with odds
    if (aHasOdds && !bHasOdds) return -1; // a comes first
    if (!aHasOdds && bHasOdds) return 1; // b comes first
    
    // Map dropdown values to actual property names
    const propMap = {
      "championship_odds": "championship_odds",
      "adp": "adp",
      "lastYearPoints": "lastYearPoints",
      "championshipPct": "championshipPct"
    };
    
    const property = propMap[sortKey] || "championship_odds";
    
    // Handle undefined/null values by sorting them last
    if (a[property] == null) return 1;
    if (b[property] == null) return -1;

    // Convert to numbers for reliable comparison
    const aValue = parseFloat(a[property]) || 0;
    const bValue = parseFloat(b[property]) || 0;

    // Determine sort direction
    const direction = (property === "lastYearPoints" || property === "championshipPct") ? -1 : 1;
    
    return (aValue - bValue) * direction;
  });
};

function formatTeamInfo(team, sortKey) {
  const formats = {
    championship_odds: v => `Odds: +${v}`,
    adp: v => `ADP: ${v}`,
    lastYearPoints: v => `Prev: ${v} Pts`,
    championshipPct: v => {
      // Safely convert to number before using toFixed
      const numValue = Number(v) || 0;
      return `% Odds: ${numValue.toFixed(1)}%`;
    }
  };
  return formats[sortKey]?.(team[sortKey]) || formats.championship_odds(team.championship_odds);
}

// Switch between rosters
function switchRoster(teamId) {
  // Hide all rosters
  document.querySelectorAll('.roster').forEach(roster => {
    roster.style.display = 'none';
  });Add commentMore actions
  
  // Show selected roster
  const activeRoster = document.getElementById(`${teamId}Roster`);
  if (activeRoster) {
    activeRoster.style.display = 'block';
  }
  
  // Update team selector value
  const selector = document.getElementById('teamSelector');
  if (selector) {
    selector.value = teamId;
  }
}

// ========================
// Event Listeners
// ========================
document.addEventListener('DOMContentLoaded', initializeDraft);

document.getElementById('seasonFilter').addEventListener('change', renderDraftBoard);
document.getElementById('sportFilter').addEventListener('change', renderDraftBoard);
document.getElementById('sortBy').addEventListener('change', renderDraftBoard);
document.getElementById('teamSearch').addEventListener('input', 
  debounce(renderDraftBoard, 300));

// ========================
// Helper Functions
// ========================
function debounce(func, wait) {
  let timeout;
  return function() {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, arguments), wait);
  };
}

function getSportIcon(team) {
  const icons = {
    "NBA": "fa-basketball",
    "NCAAB": "fa-basketball",
    "NFL": "fa-football",
    "NCAAF": "fa-football",
    "MLB": "fa-baseball",
    "NHL": "fa-hockey-puck"
  };
  return `<i class="fa-solid ${icons[team.sport]}" style="color: ${team.secondaryColor};"></i>`;
}

// ========================
// Supabase Sync
// ========================

async function saveDraftState() {
  try {
// Transform player_rosters to match backend schema
    const backendRosters = {};
    Object.entries(draftState.player_rosters).forEach(([teamIndex, roster]) => {
      backendRosters[teamIndex] = {
        NFL: roster.NFL.map(t => t.team_id || t.id),
        NBA: roster.NBA.map(t => t.team_id || t.id),
        NHL: roster.NHL.map(t => t.team_id || t.id),
        MLB: roster.MLB.map(t => t.team_id || t.id),
        NCAAF: roster.NCAAF.map(t => t.team_id || t.id),
        NCAAB: roster.NCAAB.map(t => t.team_id || t.id),
  wildcard: roster.wildcard.map(t => t.team_id || t.id),
        last_updated: new Date().toISOString()
      };
    });
    const { error } = await supabase
      .from('mock_drafts')
      .update({
        current_pick: draftState.current_pick,
        player_rosters: backendRosters,
        status: draftState.status,
        is_paused: draftState.is_paused,
      })
      .eq('id', draftState.id);

    if (error) throw error;
        console.log('Save successful');
  } catch (err) {
    console.error("Save failed:", err);
  }
}

// ========================
// Sidebar Initialization
// ========================

function initializeSidebar() {
  const teamSelector = document.getElementById('teamSelector');
  
  // Populate team selector
  teamSelector.innerHTML = draftState.team_names
    .map((name, i) => `<option value="player${i+1}">${name}</option>`)
    .join('');
  
  // Initialize rosters
  const rosterContainer = document.querySelector('.roster-container');
  rosterContainer.innerHTML = draftState.team_names
    .map((name, i) => `
      <div class="roster ${i === 0 ? 'active' : ''}" id="player${i+1}Roster">
        <h2>${name}</h2>
        <ul id="player${i+1}Teams"></ul>
      </div>`
    ).join('');
}

// ========================
// My Team Box Initialization
// ========================

function initializeMyTeamBox() {
  const currentPlayerNum = draftState.user_team_position || 0;
  const teamName = draftState.team_names[currentPlayerNum] || 'Your Team';
  
  document.querySelector('#myTeamContent h3').textContent = `${teamName}'s Picks`;
  updateMyTeamBox(); // Populate with initial data
}

// ========================
// UI Toggle Functions
// ========================
function toggleMyTeam(){
  myTeamBox.classList.toggle('collapsed');
  const arrow = document.querySelector('#toggleMyTeam .arrow');
 if (MyTeamBox.classList.contains("collapsed")) {
    arrow.innerHTML = "&#9664;"; // Right arrow
  } else {
    arrow.innerHTML = "&#9654;"; // Left arrow
  }
}

// Toggle sidebar collapse/expand
const toggleSidebar = () => {
  const sidebar = document.getElementById("sidebar");
  sidebar.classList.toggle("collapsed");

  // Adjust main content width
  const mainContent = document.querySelector(".main-content");
  mainContent.style.marginLeft = sidebar.classList.contains("collapsed") ? "0" : "350px";

  // Change arrow direction
  const arrow = document.querySelector(".sidebar-toggle .arrow");
  if (sidebar.classList.contains("collapsed")) {
    arrow.innerHTML = "&#9654;"; // Right arrow
  } else {
    arrow.innerHTML = "&#9664;"; // Left arrow
  }
};

</script>
</body>
</html>
